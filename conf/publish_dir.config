/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Config file for defining DSL2 per module options and publishing paths
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Available keys to override module options:
        ext.args   = Additional arguments appended to command in module.
        ext.args2  = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3  = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix = File name prefix for output files.
----------------------------------------------------------------------------------------
*/

//
// Optional configuration options
//

process {
    withName: 'GENERATE_SAMPLESHEET' {
        publishDir = [
            path: { "${params.outdir}/" },
            mode: params.publish_dir_mode,
            pattern: "*.{csv}"
        ]
    }

    withName: 'ARTIC_MINION' {
        ext.args = [ ].join(' ').trim()

        publishDir = [
            [
                path: { "${params.outdir}/depths" },
                mode: params.publish_dir_mode,
                pattern: "**/*.depths.png",
                saveAs: { path -> new File(path.toString()).getName() }
            ],
            [
                path: { "${params.outdir}/bams" },
                mode: params.publish_dir_mode,
                pattern: "**/*.{primertrimmed.rg.sorted.bam,primertrimmed.rg.sorted.bam.bai}",
                saveAs: { path -> new File(path.toString()).getName() }
            ],
            [
                path: { "${params.outdir}/minion_consensus" },
                mode: params.publish_dir_mode,
                pattern: "**/*.consensus.fasta",
                saveAs: { path -> new File(path.toString()).getName() }
            ],
            [
                path: { "${params.outdir}/vcf" },
                mode: params.publish_dir_mode,
                pattern: "**/*.vcf",
                saveAs: { path -> new File(path.toString()).getName() }
            ]
        ]
    }

    withName: 'ASSEMBLY_STATS' {
        publishDir = [
            path: { "${params.outdir}" },
            mode: params.publish_dir_mode,
            pattern: "*.tsv"
        ]
    }

    withName: 'RENAME_FASTA_HEADERS' {
        publishDir = [
            path: { "${params.outdir}/header_cleaned_consensus" },
            mode: params.publish_dir_mode,
            pattern: "**/*.fasta",
	    saveAs: { path -> new File(path.toString()).getName() }
        ]
    }
}
